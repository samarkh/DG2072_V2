<Window x:Class="DG2072_USB_Control.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DG2072_USB_Control"
        mc:Ignorable="d"
        Title="Rigol DG2072 USB Control" Height="1050" Width="650"
        Loaded="Window_Loaded" Closing="Window_Closing">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Connection Status Bar -->
        <DockPanel Grid.Row="0" Margin="10,5">
            <Label Content="Connection Status:" VerticalAlignment="Center"/>
            <TextBlock x:Name="ConnectionStatusTextBlock" VerticalAlignment="Center" Margin="5,0" Text="Disconnected" Foreground="Red"/>
            <Button x:Name="RefreshButton" Content="Refresh Settings" Click="RefreshButton_Click" Width="120" Margin="5,0" HorizontalAlignment="Right" IsEnabled="False"/>
            <Button x:Name="ConnectionToggleButton" Content="Connect" Click="ConnectionToggleButton_Click" Width="100" Margin="5,0" HorizontalAlignment="Right"/>
            <Button x:Name="IdentifyButton" Content="Identify" Click="IdentifyButton_Click" Width="100" Margin="5,0" HorizontalAlignment="Right" IsEnabled="False"/>
        </DockPanel>

        <!-- Main Control Panel -->
        <TabControl Grid.Row="1" Margin="10">
            <TabItem Header="Channel Controls">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Operation Mode Selection -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <Label Content="Operation Mode:" VerticalAlignment="Center"/>
                            <RadioButton x:Name="ContinuousModeRadioButton" Content="Continuous" Margin="10,0" 
                                         IsChecked="True" GroupName="OperationMode" Checked="OperationModeRadioButton_Checked"/>
                            <RadioButton x:Name="ModulationModeRadioButton" Content="Modulation" Margin="10,0" 
                                         GroupName="OperationMode" Checked="OperationModeRadioButton_Checked"/>
                        </StackPanel>

                        <!-- Channel Panel with Channel Toggle Button -->
                        <Grid Grid.Row="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Channel Selector -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                <ToggleButton x:Name="ChannelToggleButton" Content="Channel 1" Width="100" Click="ChannelToggleButton_Click" IsChecked="True"/>
                                <TextBlock x:Name="ActiveChannelTextBlock" Text="Channel 1" FontWeight="Bold" VerticalAlignment="Center" Margin="10,0"/>
                            </StackPanel>

                            <!-- Common Parameters Section (visible in both modes) -->
                            <GroupBox x:Name="ChannelParametersGroupBox" Header="Channel 1 Parameters" Grid.Row="1" Margin="5">
                                <StackPanel>
                                    <!-- Output Toggle -->
                                    <DockPanel Margin="0,5">
                                        <Label Content="Output:" Width="100"/>
                                        <ToggleButton x:Name="ChannelOutputToggle" Content="OFF" Width="80" Click="ChannelOutputToggle_Click" HorizontalAlignment="Left"/>
                                    </DockPanel>
                                    
                                    <!-- Waveform Selection (visible only in Continuous mode) -->
                                    <DockPanel x:Name="WaveformSelectionDockPanel" Margin="0,5">
                                        <Label Content="Waveform:" Width="100"/>
                                        <ComboBox x:Name="ChannelWaveformComboBox" Width="150" SelectionChanged="ChannelWaveformComboBox_SelectionChanged" HorizontalAlignment="Left">
                                            <ComboBoxItem Content="Sine"/>
                                            <ComboBoxItem Content="Square"/>
                                            <ComboBoxItem Content="Ramp"/>
                                            <ComboBoxItem Content="Pulse"/>
                                            <ComboBoxItem Content="Noise"/>
                                            <ComboBoxItem Content="Dual Tone"/>
                                            <ComboBoxItem Content="Harmonic"/>
                                            <ComboBoxItem Content="Arbitrary Waveform"/>
                                            <ComboBoxItem Content="DC"/>
                                        </ComboBox>
                                    </DockPanel>

                                    <!-- Frequency/Period Controls -->
                                    <Grid Margin="0,5" Width="580" HorizontalAlignment="Left">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition Width="Auto" MinWidth="289"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Frequency Controls -->
                                        <DockPanel x:Name="FrequencyDockPanel" Grid.Column="0" HorizontalAlignment="Left" Width="275">
                                            <Label Content="Frequency:" Width="100"/>
                                            <TextBox x:Name="ChannelFrequencyTextBox" Width="100" 
                                                     TextChanged="ChannelFrequencyTextBox_TextChanged" 
                                                     LostFocus="ChannelFrequencyTextBox_LostFocus" 
                                                     Text="1000" 
                                                     HorizontalContentAlignment="Right" 
                                                     VerticalContentAlignment="Center"/>
                                            <ComboBox x:Name="ChannelFrequencyUnitComboBox" Width="70" 
                                                     Margin="5,0,0,0" 
                                                     SelectionChanged="ChannelFrequencyUnitComboBox_SelectionChanged" 
                                                     HorizontalAlignment="Left">
                                                <ComboBoxItem Content="µHz"/>
                                                <ComboBoxItem Content="mHz"/>
                                                <ComboBoxItem Content="Hz" IsSelected="True"/>
                                                <ComboBoxItem Content="kHz"/>
                                                <ComboBoxItem Content="MHz"/>
                                            </ComboBox>
                                        </DockPanel>
                                        
                                        <!-- Mode Toggle -->
                                        <DockPanel x:Name="PulseRateModeDockPanel" Grid.Column="1" Visibility="Visible">
                                            <ToggleButton x:Name="FrequencyPeriodModeToggle" Content="To Period" Width="100" 
                                                      Click="FrequencyPeriodModeToggle_Click" IsChecked="True" HorizontalAlignment="Left"/>
                                        </DockPanel>
                                        
                                        <!-- Period Controls -->
                                        <DockPanel x:Name="PeriodDockPanel" Grid.Column="0" Margin="0,0,10,0" Visibility="Collapsed">
                                            <Label Content="Period:" Width="100"/>
                                            <TextBox x:Name="PulsePeriod" Width="100" 
                                                     TextChanged="ChannelPulsePeriodTextBox_TextChanged" 
                                                     LostFocus="ChannelPulsePeriodTextBox_LostFocus" 
                                                     Text="1" 
                                                     VerticalContentAlignment="Center" 
                                                     HorizontalContentAlignment="Right"/>
                                            <ComboBox x:Name="PulsePeriodUnitComboBox" Width="70" 
                                                      Margin="5,0,0,0" 
                                                      SelectionChanged="PulsePeriodUnitComboBox_SelectionChanged" 
                                                      HorizontalAlignment="Left">
                                                <ComboBoxItem Content="s"/>
                                                <ComboBoxItem Content="ms" IsSelected="True"/>
                                                <ComboBoxItem Content="µs"/>
                                                <ComboBoxItem Content="ns"/>
                                                <ComboBoxItem Content="ps"/>
                                            </ComboBox>
                                        </DockPanel>

                                        <!-- Period Mode Toggle -->
                                        <DockPanel x:Name="PulseRateModeDockPanel_" Grid.Column="1" Visibility="Visible">
                                            <ToggleButton x:Name="PulseRateModeToggle" Content="To Period" Width="100" 
                                                      Click="PulseRateModeToggle_Click" IsChecked="True" HorizontalAlignment="Left"/>
                                        </DockPanel>
                                    </Grid>

                                    <!-- Amplitude Controls -->
                                    <DockPanel Margin="0,5">
                                        <Label Content="Amplitude:" Width="100"/>
                                        <TextBox x:Name="ChannelAmplitudeTextBox" Width="100" TextChanged="ChannelAmplitudeTextBox_TextChanged" LostFocus="ChannelAmplitudeTextBox_LostFocus" Text="1.0" HorizontalContentAlignment="Right" VerticalContentAlignment="Center"/>
                                        <ComboBox x:Name="ChannelAmplitudeUnitComboBox" Width="70" Margin="5,0,0,0" SelectionChanged="ChannelAmplitudeUnitComboBox_SelectionChanged" HorizontalAlignment="Left">
                                            <ComboBoxItem Content="Vpp" IsSelected="True"/>
                                            <ComboBoxItem Content="mVpp"/>
                                            <ComboBoxItem Content="Vrms"/>
                                            <ComboBoxItem Content="mVrms"/>
                                        </ComboBox>
                                    </DockPanel>

                                    <!-- Offset Controls -->
                                    <DockPanel Margin="0,5">
                                        <Label Content="Offset:" Width="100"/>
                                        <TextBox x:Name="ChannelOffsetTextBox" Width="100" TextChanged="ChannelOffsetTextBox_TextChanged" LostFocus="ChannelOffsetTextBox_LostFocus" Text="0.0" HorizontalContentAlignment="Right" VerticalContentAlignment="Center"/>
                                        <ComboBox x:Name="ChannelOffsetUnitComboBox" Width="70" Margin="5,0,0,0" SelectionChanged="ChannelOffsetUnitComboBox_SelectionChanged" HorizontalAlignment="Left">
                                            <ComboBoxItem Content="V" IsSelected="True"/>
                                            <ComboBoxItem Content="mV"/>
                                        </ComboBox>
                                    </DockPanel>

                                    <!-- Phase Controls -->
                                    <DockPanel Margin="0,5">
                                        <Label Content="Phase (°):" Width="100"/>
                                        <TextBox x:Name="ChannelPhaseTextBox" Width="80" TextChanged="ChannelPhaseTextBox_TextChanged" LostFocus="ChannelPhaseTextBox_LostFocus" Text="0.0" HorizontalContentAlignment="Right" VerticalContentAlignment="Center" HorizontalAlignment="Left"/>
                                    </DockPanel>

                                    <!-- Apply Button -->
                                    <Button x:Name="ChannelApplyButton" Content="Apply Settings" Click="ChannelApplyButton_Click" Height="24" Width="120" Margin="0,5,0,0" HorizontalAlignment="Left"/>
                                </StackPanel>
                            </GroupBox>

                            <!-- Continuous Mode Sections -->
                            <Grid x:Name="ContinuousModeGrid" Grid.Row="2" Margin="5,0,5,5">
                                <!-- All existing waveform-specific sections like HarmonicsGroupBox, DualToneGroupBox, etc. -->
                                
                                <!-- Include all existing waveform-specific GroupBoxes here -->
                                <!-- Harmonics Section -->
                                <GroupBox x:Name="HarmonicsGroupBox" Header="Harmonics Controls" Visibility="Collapsed" Margin="0,10,0,0">
                                    <!-- Harmonics content here - keep the existing content unchanged -->
                                </GroupBox>

                                <!-- Pulse Section -->
                                <GroupBox x:Name="PulseGroupBox" Header="Pulse Controls" Visibility="Collapsed" Margin="0,10,0,0">
                                    <!-- Pulse controls content here -->
                                </GroupBox>

                                <!-- All other existing waveform-specific GroupBoxes -->
                                <!-- DualToneGroupBox, ArbitraryWaveformGroupBox, DCGroupBox, etc. -->
                            </Grid>

                            <!-- Modulation Mode Sections -->
                            <Grid x:Name="ModulationModeGrid" Grid.Row="2" Margin="5,0,5,5" Visibility="Collapsed">
                                <!-- Modulation Type Selection -->
                                <StackPanel>
                                    <DockPanel Margin="0,5">
                                        <Label Content="Modulation Type:" Width="120"/>
                                        <ComboBox x:Name="ModulationTypeComboBox" Width="150" SelectionChanged="ModulationTypeComboBox_SelectionChanged" HorizontalAlignment="Left">
                                            <ComboBoxItem Content="AM"/>
                                            <ComboBoxItem Content="FM"/>
                                            <ComboBoxItem Content="PM"/>
                                            <ComboBoxItem Content="ASK"/>
                                            <ComboBoxItem Content="FSK"/>
                                            <ComboBoxItem Content="PSK"/>
                                            <ComboBoxItem Content="PWM"/>
                                        </ComboBox>
                                    </DockPanel>

                                    <!-- AM Modulation Panel -->
                                    <GroupBox x:Name="AMModulationGroupBox" Header="AM Modulation Controls" Visibility="Collapsed" Margin="0,10,0,0">
                                        <StackPanel>
                                            <!-- AM State Toggle -->
                                            <DockPanel Margin="0,5">
                                                <Label Content="State:" Width="100"/>
                                                <ToggleButton x:Name="AMStateToggle" Content="OFF" Width="80" Click="AMStateToggle_Click" HorizontalAlignment="Left"/>
                                            </DockPanel>

                                            <!-- AM Source Selection -->
                                            <DockPanel Margin="0,5">
                                                <Label Content="Source:" Width="100"/>
                                                <ComboBox x:Name="AMSourceComboBox" Width="150" SelectionChanged="AMSourceComboBox_SelectionChanged" HorizontalAlignment="Left">
                                                    <ComboBoxItem Content="Internal"/>
                                                    <ComboBoxItem Content="External"/>
                                                </ComboBox>
                                            </DockPanel>

                                            <!-- AM Depth Control -->
                                            <DockPanel Margin="0,5">
                                                <Label Content="Depth (%):" Width="100"/>
                                                <TextBox x:Name="AMDepthTextBox" Width="80" TextChanged="AMDepthTextBox_TextChanged" 
                                                         LostFocus="AMDepthTextBox_LostFocus" Text="100.0" HorizontalContentAlignment="Right" VerticalContentAlignment="Center"/>
                                            </DockPanel>

                                            <!-- AM Internal Source Settings -->
                                            <GroupBox x:Name="AMInternalSettingsGroupBox" Header="Internal Modulation Settings" Margin="0,10,0,0">
                                                <StackPanel>
                                                    <!-- AM Waveform Selection -->
                                                    <DockPanel Margin="0,5">
                                                        <Label Content="Waveform:" Width="100"/>
                                                        <ComboBox x:Name="AMWaveformComboBox" Width="150" SelectionChanged="AMWaveformComboBox_SelectionChanged" HorizontalAlignment="Left">
                                                            <ComboBoxItem Content="Sine"/>
                                                            <ComboBoxItem Content="Square"/>
                                                            <ComboBoxItem Content="Triangle"/>
                                                            <ComboBoxItem Content="UpRamp"/>
                                                            <ComboBoxItem Content="DnRamp"/>
                                                            <ComboBoxItem Content="Noise"/>
                                                            <ComboBoxItem Content="Arb"/>
                                                        </ComboBox>
                                                    </DockPanel>

                                                    <!-- AM Frequency Control -->
                                                    <DockPanel Margin="0,5">
                                                        <Label Content="Mod Frequency:" Width="100"/>
                                                        <TextBox x:Name="AMFrequencyTextBox" Width="100" TextChanged="AMFrequencyTextBox_TextChanged" 
                                                                 LostFocus="AMFrequencyTextBox_LostFocus" Text="100" HorizontalContentAlignment="Right" VerticalContentAlignment="Center"/>
                                                        <ComboBox x:Name="AMFrequencyUnitComboBox" Width="70" Margin="5,0,0,0" SelectionChanged="AMFrequencyUnitComboBox_SelectionChanged" HorizontalAlignment="Left">
                                                            <ComboBoxItem Content="mHz"/>
                                                            <ComboBoxItem Content="Hz" IsSelected="True"/>
                                                            <ComboBoxItem Content="kHz"/>
                                                        </ComboBox>
                                                    </DockPanel>
                                                </StackPanel>
                                            </GroupBox>

                                            <!-- Info Text and Apply Button -->
                                            <TextBlock TextWrapping="Wrap" Margin="0,10,0,5" Foreground="#FF505050" FontStyle="Italic">
                                                AM modulation varies the amplitude of the carrier signal based on the modulating signal. 
                                                The Depth controls the intensity of modulation.
                                            </TextBlock>

                                            <Button x:Name="AMApplyButton" Content="Apply Modulation" Click="AMApplyButton_Click" 
                                                    Height="24" Width="120" Margin="0,5,0,0" HorizontalAlignment="Left"/>
                                        </StackPanel>
                                    </GroupBox>

                                    <!-- FM Modulation Panel -->
                                    <GroupBox x:Name="FMModulationGroupBox" Header="FM Modulation Controls" Visibility="Collapsed" Margin="0,10,0,0">
                                        <StackPanel>
                                            <!-- FM State Toggle -->
                                            <DockPanel Margin="0,5">
                                                <Label Content="State:" Width="100"/>
                                                <ToggleButton x:Name="FMStateToggle" Content="OFF" Width="80" Click="FMStateToggle_Click" HorizontalAlignment="Left"/>
                                            </DockPanel>

                                            <!-- FM Source Selection -->
                                            <DockPanel Margin="0,5">
                                                <Label Content="Source:" Width="100"/>
                                                <ComboBox x:Name="FMSourceComboBox" Width="150" SelectionChanged="FMSourceComboBox_SelectionChanged" HorizontalAlignment="Left">
                                                    <ComboBoxItem Content="Internal"/>
                                                    <ComboBoxItem Content="External"/>
                                                </ComboBox>
                                            </DockPanel>

                                            <!-- FM Deviation Control -->
                                            <DockPanel Margin="0,5">
                                                <Label Content="Deviation:" Width="100"/>
                                                <TextBox x:Name="FMDeviationTextBox" Width="100" TextChanged="FMDeviationTextBox_TextChanged" 
                                                         LostFocus="FMDeviationTextBox_LostFocus" Text="1.0" HorizontalContentAlignment="Right" VerticalContentAlignment="Center"/>
                                                <ComboBox x:Name="FMDeviationUnitComboBox" Width="70" Margin="5,0,0,0" SelectionChanged="FMDeviationUnitComboBox_SelectionChanged" HorizontalAlignment="Left">
                                                    <ComboBoxItem Content="mHz"/>
                                                    <ComboBoxItem Content="Hz" IsSelected="True"/>
                                                    <ComboBoxItem Content="kHz"/>
                                                    <ComboBoxItem Content="MHz"/>
                                                </ComboBox>
                                            </DockPanel>

                                            <!-- FM Internal Source Settings -->
                                            <GroupBox x:Name="FMInternalSettingsGroupBox" Header="Internal Modulation Settings" Margin="0,10,0,0">
                                                <StackPanel>
                                                    <!-- FM Waveform Selection -->
                                                    <DockPanel Margin="0,5">
                                                        <Label Content="Waveform:" Width="100"/>
                                                        <ComboBox x:Name="FMWaveformComboBox" Width="150" SelectionChanged="FMWaveformComboBox_SelectionChanged" HorizontalAlignment="Left">
                                                            <ComboBoxItem Content="Sine"/>
                                                            <ComboBoxItem Content="Square"/>
                                                            <ComboBoxItem Content="Triangle"/>
                                                            <ComboBoxItem Content="UpRamp"/>
                                                            <ComboBoxItem Content="DnRamp"/>
                                                            <ComboBoxItem Content="Noise"/>
                                                            <ComboBoxItem Content="Arb"/>
                                                        </ComboBox>
                                                    </DockPanel>

                                                    <!-- FM Frequency Control -->
                                                    <DockPanel Margin="0,5">
                                                        <Label Content="Mod Frequency:" Width="100"/>
                                                        <TextBox x:Name="FMFrequencyTextBox" Width="100" TextChanged="FMFrequencyTextBox_TextChanged" 
                                                                 LostFocus="FMFrequencyTextBox_LostFocus" Text="10" HorizontalContentAlignment="Right" VerticalContentAlignment="Center"/>
                                                        <ComboBox x:Name="FMFrequencyUnitComboBox" Width="70" Margin="5,0,0,0" SelectionChanged="FMFrequencyUnitComboBox_SelectionChanged" HorizontalAlignment="Left">
                                                            <ComboBoxItem Content="mHz"/>
                                                            <ComboBoxItem Content="Hz" IsSelected="True"/>
                                                            <ComboBoxItem Content="kHz"/>
                                                        </ComboBox>
                                                    </DockPanel>
                                                </StackPanel>
                                            </GroupBox>

                                            <!-- Info Text and Apply Button -->
                                            <TextBlock TextWrapping="Wrap" Margin="0,10,0,5" Foreground="#FF505050" FontStyle="Italic">
                                                FM modulation varies the frequency of the carrier signal based on the modulating signal. 
                                                The Deviation controls how far the frequency shifts.
                                            </TextBlock>

                                            <Button x:Name="FMApplyButton" Content="Apply Modulation" Click="FMApplyButton_Click" 
                                                    Height="24" Width="120" Margin="0,5,0,0" HorizontalAlignment="Left"/>
                                        </StackPanel>
                                    </GroupBox>

                                    <!-- PM Modulation Panel (Similar structure as AM/FM) -->
                                    <GroupBox x:Name="PMModulationGroupBox" Header="PM Modulation Controls" Visibility="Collapsed" Margin="0,10,0,0">
                                        <!-- PM Modulation controls here -->
                                    </GroupBox>

                                    <!-- Additional modulation types: ASK, FSK, PSK, PWM -->
                                    <!-- Add similar GroupBoxes for each modulation type -->
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Command Log -->
        <GroupBox Header="Command Log" Grid.Row="2" Margin="10,0,10,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="CommandLogTextBox" Grid.Column="0" Height="100" IsReadOnly="True" VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                <Button x:Name="ClearLogButton" Content="Clear Log" Grid.Column="1" Margin="5,0,0,0" VerticalAlignment="Bottom" Click="ClearLogButton_Click"/>
            </Grid>
        </GroupBox>
    </Grid>
</Window>